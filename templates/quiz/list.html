{# templates/quiz/list.html #}
{% extends 'base.html' %}
{% block content %}
<section class="space-y-6">
  <div class="text-center mb-8">
    <h1 class="text-3xl font-bold text-gray-800 mb-2">ë‹¨ì„œ ëª©ë¡</h1>
    <p class="text-gray-600">ë‹¤ë¥¸ ìœ ì €ë“¤ì˜ ë‹¨ì„œë¥¼ í™•ì¸í•´ë³´ì„¸ìš”!</p>
  </div>
  
  <div class="mb-6">
    <form method="GET" action="{{ url_for('quiz.quiz_list') }}" class="max-w-md mx-auto">
      <div class="relative">
        <input 
          type="text" 
          name="search"
          id="searchInput"
          placeholder="ë‹‰ë„¤ì„, ì†Œê°œ, MBTI, ê´€ì‹¬ì‚¬ë¡œ ê²€ìƒ‰..."
          value="{{ search_keyword or '' }}"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
        >
        <button type="submit" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600">
          ğŸ”
        </button>
      </div>
    </form>
  </div>
  
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
    {% for user in users %}
    <div class="bg-white rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300 cursor-pointer user-card flex flex-col" 
         data-user-id="{{ user.userId }}">
      
      <div class="relative w-full h-48 rounded-t-lg">
        {% if user.quizInfo.profilePhoto %}
          <img src="/{{ user.quizInfo.profilePhoto }}" 
               alt="{{ user.quizInfo.nickName }} í”„ë¡œí•„ ì‚¬ì§„" 
               class="w-full h-full object-cover rounded-t-lg"
               onerror="this.onerror=null; this.src='/static/images/default_profile.png';">
        {% else %}
          <div class="w-full h-full bg-gradient-to-br from-green-100 to-green-200 rounded-t-lg flex items-center justify-center">
            <span class="text-4xl text-green-600">ğŸ‘¤</span>
          </div>
        {% endif %}
      </div>
      
      {# ì¹´ë“œ ë‚´ìš© (flex-growë¥¼ ì¶”ê°€í•˜ì—¬ ë‚´ìš©ì´ ì¹´ë“œ ë†’ì´ë¥¼ ì±„ìš°ë„ë¡ í•¨) #}
      <div class="p-4 flex flex-col flex-grow">
        <h3 class="text-xl font-bold text-gray-800 mb-2" data-search="nickname">{{ user.quizInfo.nickName }}</h3>
        
        {% if user.quizInfo.selfIntro %}
        <p class="text-gray-600 text-sm mb-3 line-clamp-2" data-search="intro">{{ user.quizInfo.selfIntro }}</p>
        {% endif %}
        
        {# â–¼â–¼â–¼ [ìˆ˜ì •] íƒœê·¸ í‘œì‹œ ì˜ì—­ â–¼â–¼â–¼ #}
        {# íƒœê·¸ ì˜ì—­ì´ í•­ìƒ ì¹´ë“œ í•˜ë‹¨ì— ìœ„ì¹˜í•˜ë„ë¡ mt-auto í´ë˜ìŠ¤ ì¶”ê°€ #}
        <div class="mt-auto pt-3">
            <div class="flex flex-wrap gap-2">
              {# 1. MBTI íƒœê·¸ #}
              {% if user.quizInfo.mbti %}
              <span class="inline-block bg-indigo-100 text-indigo-800 text-xs font-semibold px-2.5 py-1 rounded-full" data-search="mbti">
                #{{ user.quizInfo.mbti }}
              </span>
              {% endif %}

              {# 2. ì·¨ë¯¸ íƒœê·¸ #}
              {% if user.quizInfo.hobby %}
              <span class="inline-block bg-green-100 text-green-800 text-xs font-semibold px-2.5 py-1 rounded-full" data-search="hobby">
                #{{ user.quizInfo.hobby }}
              </span>
              {% endif %}

              {# 3. ì¢‹ì•„í•˜ëŠ” ìŒì‹ íƒœê·¸ #}
              {% if user.quizInfo.favoriteFood %}
              <span class="inline-block bg-pink-100 text-pink-800 text-xs font-semibold px-2.5 py-1 rounded-full" data-search="favoriteFood">
                #{{ user.quizInfo.favoriteFood }}
              </span>
              {% endif %}
            </div>
        </div>
        {# â–²â–²â–² ìˆ˜ì • ì™„ë£Œ â–²â–²â–² #}
        
      </div>
    </div>
    {% endfor %}
  </div>
  
  {% if not users %}
  <div class="text-center py-12">
    <div class="text-6xl mb-4">ğŸ˜”</div>
    <h3 class="text-xl font-semibold text-gray-700 mb-2">
      {% if search_keyword %}
      "{{ search_keyword }}"ì— ëŒ€í•œ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤
      {% else %}
      ì•„ì§ ë“±ë¡ëœ ìœ ì €ê°€ ì—†ìŠµë‹ˆë‹¤
      {% endif %}
    </h3>
    <p class="text-gray-500">
      {% if search_keyword %}
      ë‹¤ë¥¸ í‚¤ì›Œë“œë¡œ ê²€ìƒ‰í•´ë³´ì„¸ìš”.
      {% else %}
      ì²« ë²ˆì§¸ ìœ ì €ê°€ ë˜ì–´ë³´ì„¸ìš”!
      {% endif %}
    </p>
  </div>
  {% endif %}
  
  {% if total_pages > 1 %}
  <nav class="flex justify-center items-center space-x-2 mt-8">
    <a href="{{ url_for('quiz.quiz_list', page=current_page - 1, search=search_keyword) if current_page > 1 else '#' }}"
       class="px-4 py-2 border rounded-md {{ 'bg-gray-200 text-gray-400 cursor-not-allowed' if current_page == 1 else 'bg-white text-gray-700 hover:bg-gray-50' }}">
      ì´ì „
    </a>
    {% for page_num in range(1, total_pages + 1) %}
      <a href="{{ url_for('quiz.quiz_list', page=page_num, search=search_keyword) }}"
         class="px-4 py-2 border rounded-md {{ 'bg-green-500 text-white' if page_num == current_page else 'bg-white text-gray-700 hover:bg-gray-50' }}">
        {{ page_num }}
      </a>
    {% endfor %}
    <a href="{{ url_for('quiz.quiz_list', page=current_page + 1, search=search_keyword) if current_page < total_pages else '#' }}"
       class="px-4 py-2 border rounded-md {{ 'bg-gray-200 text-gray-400 cursor-not-allowed' if current_page == total_pages else 'bg-white text-gray-700 hover:bg-gray-50' }}">
      ë‹¤ìŒ
    </a>
  </nav>
  {% endif %}
</section>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const userCards = document.querySelectorAll('.user-card');
  userCards.forEach(card => {
    card.addEventListener('click', function() {
      const userId = this.getAttribute('data-user-id');
      if (userId) {
        window.location.href = `/quiz/usr/${userId}`;
      }
    });
  });
});
</script>
{% endblock %}