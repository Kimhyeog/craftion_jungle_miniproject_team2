{# templates/quiz/list.html #}
{% extends 'base.html' %}
{% block content %}
<section class="space-y-6">
  <div class="text-center mb-8">
    <h1 class="text-3xl font-bold text-gray-800 mb-2">유저 목록</h1>
    <p class="text-gray-600">다른 유저들의 프로필을 확인해보세요!</p>
  </div>
  
  <div class="mb-6">
    <form method="GET" action="{{ url_for('quiz.quiz_list') }}" class="max-w-md mx-auto">
      <div class="relative">
        <input 
          type="text" 
          name="search"
          id="searchInput"
          placeholder="닉네임, 소개, MBTI, 관심사로 검색..."
          value="{{ search_keyword or '' }}"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
        >
        <button type="submit" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600">
          🔍
        </button>
      </div>
    </form>
  </div>
  
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
    {# ▼▼▼ [수정] user.quizInfo가 있는지 먼저 확인하는 조건문 추가 ▼▼▼ #}
    {% for user in users %}
      {% if user.quizInfo %}
      <div class="bg-white rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300 cursor-pointer user-card" 
           data-user-id="{{ user.userId }}">
        <div class="relative">
          <div class="w-full h-48 bg-gradient-to-br from-green-100 to-green-200 rounded-t-lg flex items-center justify-center">
            <span class="text-4xl text-green-600">👤</span>
          </div>
        </div>
        
        <div class="p-4">
          <h3 class="text-xl font-bold text-gray-800 mb-2" data-search="nickname">{{ user.quizInfo.nickName }}</h3>
          
          {% if user.quizInfo.selfIntro %}
          <p class="text-gray-600 text-sm mb-3 line-clamp-2" data-search="intro">{{ user.quizInfo.selfIntro }}</p>
          {% endif %}
          
          {% if user.quizInfo.mbti %}
          <div class="flex items-center mb-2">
            <span class="bg-blue-100 text-blue-800 text-xs font-medium px-2 py-1 rounded-full" data-search="mbti">
              {{ user.quizInfo.mbti }}
            </span>
          </div>
          {% endif %}
          
          <div class="flex flex-wrap gap-1 mb-3">
            {% if user.quizInfo.favoriteFood %}
            <span class="bg-orange-100 text-orange-800 text-xs px-2 py-1 rounded" data-search="food">🍽️ {{ user.quizInfo.favoriteFood }}</span>
            {% endif %}
            {% if user.quizInfo.hobby %}
            <span class="bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded" data-search="hobby">🎨 {{ user.quizInfo.hobby }}</span>
            {% endif %}
          </div>
          
          {% if user.quizInfo.selfMotive %}
          <p class="text-gray-500 text-xs italic" data-search="motive">"{{ user.quizInfo.selfMotive }}"</p>
          {% endif %}
        </div>
      </div>
      {% endif %}
    {% endfor %}
  </div>
  
  {% if not users %}
  <div class="text-center py-12">
    <div class="text-6xl mb-4">😔</div>
    <h3 class="text-xl font-semibold text-gray-700 mb-2">
      {% if search_keyword %}
      "{{ search_keyword }}"에 대한 검색 결과가 없습니다
      {% else %}
      아직 등록된 유저가 없습니다
      {% endif %}
    </h3>
    <p class="text-gray-500">
      {% if search_keyword %}
      다른 키워드로 검색해보세요.
      {% else %}
      첫 번째 유저가 되어보세요!
      {% endif %}
    </p>
  </div>
  {% endif %}
  
  {% if total_pages > 1 %}
  <nav class="flex justify-center items-center space-x-2 mt-8">
    <a href="{{ url_for('quiz.quiz_list', page=current_page - 1, search=search_keyword) if current_page > 1 else '#' }}"
       class="px-4 py-2 border rounded-md {{ 'bg-gray-200 text-gray-400 cursor-not-allowed' if current_page == 1 else 'bg-white text-gray-700 hover:bg-gray-50' }}">
      이전
    </a>
    {% for page_num in range(1, total_pages + 1) %}
      <a href="{{ url_for('quiz.quiz_list', page=page_num, search=search_keyword) }}"
         class="px-4 py-2 border rounded-md {{ 'bg-green-500 text-white' if page_num == current_page else 'bg-white text-gray-700 hover:bg-gray-50' }}">
        {{ page_num }}
      </a>
    {% endfor %}
    <a href="{{ url_for('quiz.quiz_list', page=current_page + 1, search=search_keyword) if current_page < total_pages else '#' }}"
       class="px-4 py-2 border rounded-md {{ 'bg-gray-200 text-gray-400 cursor-not-allowed' if current_page == total_pages else 'bg-white text-gray-700 hover:bg-gray-50' }}">
      다음
    </a>
  </nav>
  {% endif %}
</section>
{% endblock %}

{% block scripts %}
{# [수정] list.js는 이제 서버 기반 검색/페이지네이션을 사용하므로 클라이언트 사이드 필터링 기능이 필요 없습니다. #}
{# 카드 클릭 기능만 남겨둡니다. #}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const userCards = document.querySelectorAll('.user-card');
  userCards.forEach(card => {
    card.addEventListener('click', function() {
      const userId = this.getAttribute('data-user-id');
      if (userId) {
        // [수정] /user/profile/ 이 아닌 퀴즈 대시보드로 연결해야 할 수 있습니다.
        // 현재 코드에서는 /quiz/usr/ 로 연결하여 DB ID 기반의 대시보드로 리다이렉트합니다.
        window.location.href = `/quiz/usr/${userId}`;
      }
    });
  });
});
</script>
{% endblock %}