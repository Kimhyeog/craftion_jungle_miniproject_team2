{# templates/quiz/list.html #}
{% extends 'base.html' %}
{% block content %}
<section class="space-y-6">
  <div class="text-center mb-8">
    <h1 class="text-3xl font-bold text-gray-800 mb-2">단서 목록</h1>
    <p class="text-gray-600">다른 유저들의 단서를 확인해보세요!</p>
  </div>
  
  <div class="mb-6">
    <form method="GET" action="{{ url_for('quiz.quiz_list') }}" class="max-w-md mx-auto">
      <div class="relative">
        <input 
          type="text" 
          name="search"
          id="searchInput"
          placeholder="닉네임, 소개, MBTI, 관심사로 검색..."
          value="{{ search_keyword or '' }}"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
        >
        <button type="submit" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600">
          🔍
        </button>
      </div>
    </form>
  </div>
  
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
    {% for user in users %}
    <div class="bg-white rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300 cursor-pointer user-card" 
         data-user-id="{{ user.userId }}">
      
      {# ▼▼▼ [수정] 프로필 사진 표시 영역 ▼▼▼ #}
      <div class="relative w-full h-48 rounded-t-lg">
        {# 1. profilePhoto 값이 존재하는 경우, 해당 이미지를 출력합니다. #}
        {% if user.quizInfo.profilePhoto %}
          <img src="/{{ user.quizInfo.profilePhoto }}" 
               alt="{{ user.quizInfo.nickName }} 프로필 사진" 
               class="w-full h-full object-cover rounded-t-lg"
               onerror="this.onerror=null; this.src='/static/images/default_profile.png';">
        {# 2. profilePhoto 값이 없는 경우(null 또는 빈 문자열), 기본 아이콘을 출력합니다. #}
        {% else %}
          <div class="w-full h-full bg-gradient-to-br from-green-100 to-green-200 rounded-t-lg flex items-center justify-center">
            <span class="text-4xl text-green-600">👤</span>
          </div>
        {% endif %}
      </div>
      {# ▲▲▲ 수정 완료 ▲▲▲ #}
      
      {# 카드 내용 (이하 코드는 기존과 동일) #}
      <div class="p-4">
        <h3 class="text-xl font-bold text-gray-800 mb-2" data-search="nickname">{{ user.quizInfo.nickName }}</h3>
        
        {% if user.quizInfo.selfIntro %}
        <p class="text-gray-600 text-sm mb-3 line-clamp-2" data-search="intro">{{ user.quizInfo.selfIntro }}</p>
        {% endif %}
        
        {# ... (나머지 카드 내용) ... #}
      </div>
    </div>
    {% endfor %}
  </div>
  
  {% if not users %}
  <div class="text-center py-12">
    <div class="text-6xl mb-4">😔</div>
    <h3 class="text-xl font-semibold text-gray-700 mb-2">
      {% if search_keyword %}
      "{{ search_keyword }}"에 대한 검색 결과가 없습니다
      {% else %}
      아직 등록된 유저가 없습니다
      {% endif %}
    </h3>
    <p class="text-gray-500">
      {% if search_keyword %}
      다른 키워드로 검색해보세요.
      {% else %}
      첫 번째 유저가 되어보세요!
      {% endif %}
    </p>
  </div>
  {% endif %}
  
  {% if total_pages > 1 %}
  <nav class="flex justify-center items-center space-x-2 mt-8">
    <a href="{{ url_for('quiz.quiz_list', page=current_page - 1, search=search_keyword) if current_page > 1 else '#' }}"
       class="px-4 py-2 border rounded-md {{ 'bg-gray-200 text-gray-400 cursor-not-allowed' if current_page == 1 else 'bg-white text-gray-700 hover:bg-gray-50' }}">
      이전
    </a>
    {% for page_num in range(1, total_pages + 1) %}
      <a href="{{ url_for('quiz.quiz_list', page=page_num, search=search_keyword) }}"
         class="px-4 py-2 border rounded-md {{ 'bg-green-500 text-white' if page_num == current_page else 'bg-white text-gray-700 hover:bg-gray-50' }}">
        {{ page_num }}
      </a>
    {% endfor %}
    <a href="{{ url_for('quiz.quiz_list', page=current_page + 1, search=search_keyword) if current_page < total_pages else '#' }}"
       class="px-4 py-2 border rounded-md {{ 'bg-gray-200 text-gray-400 cursor-not-allowed' if current_page == total_pages else 'bg-white text-gray-700 hover:bg-gray-50' }}">
      다음
    </a>
  </nav>
  {% endif %}
</section>
{% endblock %}

{% block scripts %}
{# [수정] list.js는 이제 서버 기반 검색/페이지네이션을 사용하므로 클라이언트 사이드 필터링 기능이 필요 없습니다. #}
{# 카드 클릭 기능만 남겨둡니다. #}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const userCards = document.querySelectorAll('.user-card');
  userCards.forEach(card => {
    card.addEventListener('click', function() {
      const userId = this.getAttribute('data-user-id');
      if (userId) {
        // [수정] /user/profile/ 이 아닌 퀴즈 대시보드로 연결해야 할 수 있습니다.
        // 현재 코드에서는 /quiz/usr/ 로 연결하여 DB ID 기반의 대시보드로 리다이렉트합니다.
        window.location.href = `/quiz/usr/${userId}`;
      }
    });
  });
});
</script>
{% endblock %}